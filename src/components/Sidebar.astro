---
import MotionHeadline from "./MotionHeadline.jsx";

// Define navigation items in one place for both rendering and tab switching
const navItems = [
  {
    href: "#about",
    label: "ABOUT",
    icon: "fa-user",
    iconType: "fa-solid",
    badge: "1",
    textClass: "text-text",
  },
  {
    href: "#projects",
    label: "PROJECTS",
    icon: "fa-folder-open",
    iconType: "fa-solid",
    badge: "2",
    textClass: "text-text-muted",
  },
  // Uncomment to add education tab
  // {
  //   href: "#education",
  //   label: "EDUCATION",
  //   icon: "fa-graduation-cap",
  //   iconType: "fa-solid",
  //   badge: null,
  //   textClass: "text-text-muted",
  // },
  {
    href: "#contact",
    label: "CONTACT",
    icon: "fa-envelope",
    iconType: "fa-solid",
    badge: "3",
    textClass: "text-text-muted",
  },
];
---

<!-- Desktop Sidebar -->
<aside class="hidden lg:block fixed left-0 top-0 h-full w-[200px] lg:w-[220px] min-w-[80px] lg:min-w-[96px] z-30 overflow-hidden font-sans" role="complementary" aria-label="Sidebar">
  <div class="bg-background rounded-2xl p-4 lg:p-6 flex flex-col items-center gap-3 lg:gap-6 h-full">
    <div class="w-20 lg:w-32 h-20 lg:h-32 aspect-square flex-shrink-0 mx-auto rounded-full bg-blue-900/30 flex items-center justify-center text-3xl lg:text-5xl font-bold text-white mb-2 select-none border-4 border-blue-800 overflow-hidden">
      <img 
        src="/me.jpg" 
        alt="Eugene Belikov portrait" 
        class="w-full h-full aspect-square object-cover rounded-full select-none"
        draggable="false"
      />
    </div>
    <div class="flex flex-col flex-1 w-full text-center">
      <div class="text-lg lg:text-2xl font-bold mb-1 text-text font-serif">Eugene Wajt</div>
      <div class="text-base lg:text-lg font-semibold mb-2 font-serif text-blue-200 dark:text-blue-100">
        <MotionHeadline client:load className="text-blue-200 dark:text-blue-100" />
      </div>
      <blockquote class="border-l-4 border-accent pl-3 lg:pl-4 italic text-text-muted text-xs lg:text-sm mb-4 font-mono">
        "Code is like humor. When you have to explain it, it's bad." â€” Cory House
      </blockquote>
      <nav class="flex flex-col gap-3 lg:gap-4 w-full max-w-xs items-start mx-auto mb-8 lg:mb-10" role="navigation" aria-label="Sidebar navigation">
        {navItems.map((item, idx) => (
          <a
            href={item.href}
            class={`nav-link flex items-center gap-3 group font-semibold text-sm tracking-widest text-blue-400 ${item.textClass} relative py-1 pl-0 transition-all duration-200`}
            aria-label={item.label.charAt(0) + item.label.slice(1).toLowerCase() + ' section'}
            aria-current={idx === 0 ? 'page' : undefined}
          >
            <i class={`${item.iconType} ${item.icon} text-blue-400`} aria-hidden="true"></i>
            <span class="flex flex-row items-center justify-between min-w-[110px]">
              <span class="group-hover:text-blue-500 transition-all block">{item.label}</span>
              {item.badge && (
                <span class="ml-2 inline-flex items-center justify-center w-5 h-5 rounded-full bg-blue-900 text-blue-200 text-xs font-bold border border-blue-700 select-none">{item.badge}</span>
              )}
            </span>
          </a>
        ))}
      </nav>
    </div>
    <div class="flex justify-center gap-3 lg:gap-6 mb-6 lg:mb-8">
      <a
        href="https://github.com/yevblk"
        target="_blank"
        rel="noopener"
        aria-label="GitHub"
        class="text-text-muted hover:text-accent transition-colors duration-200 text-2xl lg:text-[32px]"
      >
        <i class="fa-brands fa-github" aria-hidden="true"></i>
      </a>
      {/*
      <a
        href="https://linkedin.com/"
        target="_blank"
        rel="noopener"
        aria-label="LinkedIn"
        class="text-text-muted hover:text-accent transition-colors duration-200 text-[32px]"
      >
        <i class="fa-brands fa-linkedin" aria-hidden="true"></i>
      </a>
      */}
      <a
        href="https://t.me/jabilyk"
        target="_blank"
        rel="noopener"
        aria-label="Telegram"
        class="text-text-muted hover:text-accent transition-colors duration-200 text-2xl lg:text-[32px]"
      >
        <i class="fa-brands fa-telegram" aria-hidden="true"></i>
      </a>
    </div>
    
    <!-- CV Download Button -->
    <div class="flex justify-center mb-4">
      <a
        href="/Eugene_Belikov_CV.pdf"
        download="Eugene_Belikov_CV.pdf"
        aria-label="Download CV"
        class="modern-cv-btn inline-flex items-center gap-2 px-4 py-2 font-semibold transition-all duration-200 text-sm"
      >
        <i class="fa-solid fa-download" aria-hidden="true"></i>
        <span>Download CV</span>
      </a>
    </div>
    <slot />
  </div>
</aside>

<!-- Vertical Mobile Sidebar for landscape phones/tablets -->
<style>
@media (min-width: 600px) and (max-width: 1023px) {
  .vertical-mobile-sidebar {
    display: flex !important;
    flex-direction: column;
    position: fixed;
    left: 0;
    top: 0;
    height: 100vh;
    width: 64px;
    background: #1a2233;
    z-index: 40;
    border-right: 1px solid #232b3a;
    box-shadow: 2px 0 12px 0 rgba(36, 37, 38, 0.15);
    align-items: center;
    padding-top: 1rem;
    gap: 1.5rem;
  }
  .vertical-mobile-sidebar .nav-link {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: 0.85rem;
    color: #b0b8c8;
    padding: 0.5rem 0;
    width: 100%;
    transition: color 0.2s;
  }
  .vertical-mobile-sidebar .nav-link.active,
  .vertical-mobile-sidebar .nav-link:hover {
    color: #3b82f6;
    font-weight: bold;
  }
  .vertical-mobile-sidebar .nav-link i {
    font-size: 1.3rem;
    margin-bottom: 0.2rem;
  }
}
@media (max-width: 1023px) and (min-width: 600px) {
  #mobile-nav { display: none !important; }
}
.modern-cv-btn {
  background: linear-gradient(90deg, #2563eb 0%, #1e40af 100%);
  box-shadow: 0 4px 24px 0 rgba(37,99,235,0.15);
  color: #fff;
  border: 1.5px solid rgba(37,99,235,0.25);
  backdrop-filter: blur(2px);
  border-radius: 0.75rem;
  position: relative;
  overflow: hidden;
  transition: all 0.2s;
}
.modern-cv-btn:before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(120deg, #60a5fa33 0%, #1e40af22 100%);
  opacity: 0;
  transition: opacity 0.3s;
  z-index: 0;
}
.modern-cv-btn:hover:before,
.modern-cv-btn:focus-visible:before {
  opacity: 1;
}
.modern-cv-btn:hover,
.modern-cv-btn:focus-visible {
  transform: scale(1.045);
  box-shadow: 0 6px 32px 0 rgba(37,99,235,0.22);
  border-color: #60a5fa;
  outline: none;
}
.modern-cv-btn i {
  font-size: 1.1em;
  z-index: 1;
}
.modern-cv-btn span {
  z-index: 1;
}
</style>

<div class="vertical-mobile-sidebar hidden">
  {navItems.map((item, idx) => (
    <a
      href={item.href}
      class={`nav-link flex flex-col items-center ${item.textClass} ${idx === 0 ? 'active' : ''}`}
    >
      <i class={`${item.iconType} ${item.icon}`}></i>
      <span class="text-[10px] mt-1">{item.label}</span>
    </a>
  ))}
  <a
    href="/Eugene_Belikov_CV.pdf"
    download="Eugene_Belikov_CV.pdf"
    class="nav-link flex flex-col items-center text-text-muted"
  >
    <i class="fa-solid fa-download"></i>
    <span class="text-[10px] mt-1">CV</span>
  </a>
</div>

<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    // Desktop scroll spy
    const sections = Array.from(document.querySelectorAll('.nav-link'))
      .map(link => {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
          return document.getElementById(href.slice(1));
        }
        return null;
      });
    const navLinks = document.querySelectorAll('.nav-link');
    function onScroll() {
      let current = '';
      sections.forEach(section => {
        if (section && window.scrollY >= section.offsetTop - 120) {
          current = section.id;
        }
      });
      navLinks.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href') === `#${current}`) {
          link.classList.add('active');
        }
      });
    }
    window.addEventListener('scroll', onScroll);
    onScroll();

    // Tab switching by 1, 2, 3, ... (auto-generated)
    window.addEventListener('keydown', (e) => {
      if (['INPUT', 'TEXTAREA'].includes(document.activeElement.tagName)) return;
      // Only allow number keys 1-9
      if (/^[1-9]$/.test(e.key)) {
        const idx = parseInt(e.key, 10) - 1;
        const navLinksArr = Array.from(document.querySelectorAll('.nav-link'));
        if (idx >= 0 && idx < navLinksArr.length) {
          const link = navLinksArr[idx];
          if (link) {
            link.focus();
            link.click();
          }
        }
      }
    });
  });
</script>

<style>
  .nav-link.active span {
    color: #60a5fa !important; /* Tailwind sky-400 */
  }
  .nav-link.active .block.w-10.h-px {
    background: #60a5fa !important;
  }
</style>