---
import TypedText from "./TypedText.jsx";

// Define navigation items in one place for both rendering and tab switching
const navItems = [
  {
    href: "#about",
    label: "ABOUT",
    icon: "fa-user",
    iconType: "fa-solid",
    badge: "1",
    textClass: "text-text",
  },
  {
    href: "#projects",
    label: "PROJECTS",
    icon: "fa-folder-open",
    iconType: "fa-solid",
    badge: "2",
    textClass: "text-text-muted",
  },
  // Uncomment to add education tab
  // {
  //   href: "#education",
  //   label: "EDUCATION",
  //   icon: "fa-graduation-cap",
  //   iconType: "fa-solid",
  //   badge: null,
  //   textClass: "text-text-muted",
  // },
  {
    href: "#contact",
    label: "CONTACT",
    icon: "fa-envelope",
    iconType: "fa-solid",
    badge: "3",
    textClass: "text-text-muted",
  },
];
---

<!-- Desktop Sidebar -->
<aside class="hidden lg:block fixed left-0 top-0 h-full w-[200px] lg:w-[220px] min-w-[80px] lg:min-w-[96px] z-30 overflow-hidden font-sans">
  <div class="bg-background rounded-2xl p-4 lg:p-6 flex flex-col items-center gap-3 lg:gap-6 h-full">
    <div class="w-20 lg:w-32 h-20 lg:h-32 aspect-square flex-shrink-0 mx-auto rounded-full bg-blue-900/30 flex items-center justify-center text-3xl lg:text-5xl font-bold text-white mb-2 select-none border-4 border-blue-800 overflow-hidden">
      <img 
        src="/me.jpg" 
        alt="Eugene Belikov" 
        class="w-full h-full aspect-square object-cover rounded-full select-none"
        draggable="false"
      />
    </div>
    <div class="flex flex-col flex-1 w-full text-center">
      <div class="text-lg lg:text-2xl font-bold mb-1 text-text font-serif">Eugene Wajt</div>
      <div class="text-base lg:text-lg font-semibold mb-2 font-serif text-blue-200 dark:text-blue-100">
        <TypedText client:load className="text-blue-200 dark:text-blue-100" />
      </div>
      <blockquote class="border-l-4 border-accent pl-3 lg:pl-4 italic text-text-muted text-xs lg:text-sm mb-4 font-mono">
        "Code is like humor. When you have to explain it, it's bad." — Cory House
      </blockquote>
      <nav class="flex flex-col gap-3 lg:gap-4 w-full max-w-xs items-start mx-auto mb-8 lg:mb-10">
        {navItems.map((item, idx) => (
          <a
            href={item.href}
            class={`nav-link flex items-center gap-3 group font-semibold text-sm tracking-widest ${item.textClass} relative py-1 pl-0 transition-all duration-200`}
          >
            <i class={`${item.iconType} ${item.icon} text-accent`}></i>
            <span class="flex flex-row items-center justify-between min-w-[110px]">
              <span class="group-hover:text-accent transition-all block">{item.label}</span>
              {item.badge && (
                <span class="ml-2 inline-flex items-center justify-center w-5 h-5 rounded-full bg-blue-900 text-blue-200 text-xs font-bold border border-blue-700 select-none">{item.badge}</span>
              )}
            </span>
          </a>
        ))}
      </nav>
    </div>
    <div class="flex justify-center gap-3 lg:gap-6 mb-6 lg:mb-8">
      <a
        href="https://github.com/yevblk"
        target="_blank"
        rel="noopener"
        aria-label="GitHub"
        class="text-text-muted hover:text-accent transition-colors duration-200 text-2xl lg:text-[32px]"
      >
        <i class="fa-brands fa-github"></i>
      </a>
      {/*
      <a
        href="https://linkedin.com/"
        target="_blank"
        rel="noopener"
        aria-label="LinkedIn"
        class="text-text-muted hover:text-accent transition-colors duration-200 text-[32px]"
      >
        <i class="fa-brands fa-linkedin"></i>
      </a>
      */}
      <a
        href="https://t.me/jabilyk"
        target="_blank"
        rel="noopener"
        aria-label="Telegram"
        class="text-text-muted hover:text-accent transition-colors duration-200 text-2xl lg:text-[32px]"
      >
        <i class="fa-brands fa-telegram"></i>
      </a>
    </div>
    <slot />
  </div>
</aside>

<!-- Mobile Sidebar as Section -->
<section class="block lg:hidden bg-background rounded-2xl p-4 sm:p-6 flex flex-col items-center gap-4 sm:gap-6 my-6 sm:my-8 min-w-[96px] sm:min-w-[128px] overflow-hidden font-sans">
  <div class="w-24 sm:w-32 h-24 sm:h-32 aspect-square flex-shrink-0 mx-auto rounded-full bg-blue-900/30 flex items-center justify-center text-4xl sm:text-5xl font-bold text-white mb-2 select-none border-4 border-blue-800 overflow-hidden">
    <img 
      src="/me.jpg" 
      alt="Eugene Belikov" 
      class="w-full h-full aspect-square object-cover rounded-full select-none"
      draggable="false"
    />
  </div>
  <div class="flex flex-col flex-1 w-full text-center">
    <div class="text-xl sm:text-2xl font-bold mb-1 text-text font-serif">Eugene Wajt</div>
    <div class="text-base sm:text-lg font-semibold mb-2 font-serif text-blue-200 dark:text-blue-100">
      <TypedText client:load className="text-blue-200 dark:text-blue-100" />
    </div>
    <blockquote class="border-l-4 border-accent pl-3 sm:pl-4 italic text-text-muted text-xs sm:text-sm mb-4 font-mono">
      "Code is like humor. When you have to explain it, it's bad." — Cory House
    </blockquote>
  </div>
  <div class="flex justify-center gap-4 sm:gap-6 mb-6 sm:mb-8">
    <a
      href="https://github.com/yevblk"
      target="_blank"
      rel="noopener"
      aria-label="GitHub"
      class="text-text-muted hover:text-accent transition-colors duration-200 text-2xl sm:text-[32px]"
    >
      <i class="fa-brands fa-github"></i>
    </a>
    {/*
    <a
      href="https://linkedin.com/"
      target="_blank"
      rel="noopener"
      aria-label="LinkedIn"
      class="text-text-muted hover:text-accent transition-colors duration-200 text-[32px]"
    >
      <i class="fa-brands fa-linkedin"></i>
    </a>
    */}
    <a
      href="https://t.me/jabilyk"
      target="_blank"
      rel="noopener"
      aria-label="Telegram"
      class="text-text-muted hover:text-accent transition-colors duration-200 text-2xl sm:text-[32px]"
    >
      <i class="fa-brands fa-telegram"></i>
    </a>
  </div>
</section>

<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    // Desktop scroll spy
    const sections = Array.from(document.querySelectorAll('.nav-link'))
      .map(link => {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
          return document.getElementById(href.slice(1));
        }
        return null;
      });
    const navLinks = document.querySelectorAll('.nav-link');
    function onScroll() {
      let current = '';
      sections.forEach(section => {
        if (section && window.scrollY >= section.offsetTop - 120) {
          current = section.id;
        }
      });
      navLinks.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href') === `#${current}`) {
          link.classList.add('active');
        }
      });
    }
    window.addEventListener('scroll', onScroll);
    onScroll();

    // Tab switching by 1, 2, 3, ... (auto-generated)
    window.addEventListener('keydown', (e) => {
      if (['INPUT', 'TEXTAREA'].includes(document.activeElement.tagName)) return;
      // Only allow number keys 1-9
      if (/^[1-9]$/.test(e.key)) {
        const idx = parseInt(e.key, 10) - 1;
        const navLinksArr = Array.from(document.querySelectorAll('.nav-link'));
        if (idx >= 0 && idx < navLinksArr.length) {
          const link = navLinksArr[idx];
          if (link) {
            link.focus();
            link.click();
          }
        }
      }
    });
  });
</script>

<style>
  .nav-link.active span {
    color: #60a5fa !important; /* Tailwind sky-400 */
  }
  .nav-link.active .block.w-10.h-px {
    background: #60a5fa !important;
  }
</style>